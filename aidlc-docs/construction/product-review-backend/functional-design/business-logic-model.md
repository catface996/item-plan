# 业务逻辑模型 - 商品审核模块

## 业务流程概览

```
商家提交 → 待审核 → 初审 → 初审通过 → 复审 → 通过
                ↓                    ↓
              需修改 ←←←←←←←←←←←← 需修改
                ↓                    ↓
              拒绝 ←←←←←←←←←←←←←← 拒绝
```

---

## 1. 商品提交流程

### 流程描述
商家创建新商品并提交审核

### 前置条件
- 用户已登录
- 用户角色为 MERCHANT

### 流程步骤

```
1. 商家填写商品信息
   ├── 输入: name, description, price
   └── 验证: 数据格式和范围

2. 系统验证商品数据
   ├── 验证 name: 非空, 长度1-100
   ├── 验证 description: 非空, 长度1-1000
   └── 验证 price: 0.01 - 999999.99

3. 创建商品记录
   ├── 设置 status = PENDING
   ├── 设置 merchantId = 当前用户ID
   ├── 设置 createdAt = 当前时间
   └── 设置 updatedAt = 当前时间

4. 返回创建结果
   └── 输出: 商品ID, 商品信息
```

### 后置条件
- 商品记录已创建
- 商品状态为 PENDING

---

## 2. 初审流程

### 流程描述
普通审核员对待审核商品进行初审

### 前置条件
- 用户已登录
- 用户角色为 REVIEWER
- 商品状态为 PENDING

### 流程步骤

```
1. 审核员查看待审核列表
   └── 查询: status = PENDING

2. 审核员选择商品查看详情
   └── 显示: 商品信息, 商家信息

3. 审核员执行审核操作
   ├── 选择: PASS / REJECT / NEED_MODIFY
   └── 填写: 审核意见 (REJECT/NEED_MODIFY时必填)

4. 系统验证审核数据
   ├── 验证商品状态为 PENDING
   ├── 验证审核员权限
   └── 验证意见必填规则

5. 更新商品状态
   ├── PASS → status = FIRST_PASS
   ├── REJECT → status = REJECTED
   └── NEED_MODIFY → status = NEED_MODIFY

6. 创建审核记录
   ├── 设置 productId
   ├── 设置 auditorId = 当前用户ID
   ├── 设置 result
   ├── 设置 comment
   └── 设置 createdAt = 当前时间

7. 返回审核结果
```

### 后置条件
- 商品状态已更新
- 审核记录已创建

---

## 3. 复审流程

### 流程描述
高级审核员对初审通过的商品进行复审

### 前置条件
- 用户已登录
- 用户角色为 SENIOR_REVIEWER
- 商品状态为 FIRST_PASS

### 流程步骤

```
1. 高级审核员查看待复审列表
   └── 查询: status = FIRST_PASS

2. 高级审核员选择商品查看详情
   └── 显示: 商品信息, 商家信息, 初审记录

3. 高级审核员执行审核操作
   ├── 选择: PASS / REJECT / NEED_MODIFY
   └── 填写: 审核意见 (REJECT/NEED_MODIFY时必填)

4. 系统验证审核数据
   ├── 验证商品状态为 FIRST_PASS
   ├── 验证审核员权限
   └── 验证意见必填规则

5. 更新商品状态
   ├── PASS → status = APPROVED
   ├── REJECT → status = REJECTED
   └── NEED_MODIFY → status = NEED_MODIFY

6. 创建审核记录
   ├── 设置 productId
   ├── 设置 auditorId = 当前用户ID
   ├── 设置 result
   ├── 设置 comment
   └── 设置 createdAt = 当前时间

7. 返回审核结果
```

### 后置条件
- 商品状态已更新为终态或需修改
- 审核记录已创建

---

## 4. 商品修改重提流程

### 流程描述
商家修改被退回的商品并重新提交审核

### 前置条件
- 用户已登录
- 用户角色为 MERCHANT
- 商品状态为 NEED_MODIFY
- 商品属于当前商家

### 流程步骤

```
1. 商家查看被退回商品
   └── 显示: 商品信息, 审核意见

2. 商家修改商品信息
   ├── 可修改: name, description, price
   └── 验证: 数据格式和范围

3. 系统验证商品数据
   ├── 验证商品状态为 NEED_MODIFY
   ├── 验证商品属于当前商家
   └── 验证数据格式

4. 更新商品信息
   ├── 更新 name, description, price
   ├── 设置 status = PENDING
   └── 设置 updatedAt = 当前时间

5. 返回更新结果
   └── 注: 保留所有历史审核记录
```

### 后置条件
- 商品信息已更新
- 商品状态重置为 PENDING
- 历史审核记录保留

---

## 状态转换图

```
                    ┌─────────────┐
                    │   PENDING   │◄─────────────────┐
                    │   (待审核)   │                  │
                    └──────┬──────┘                  │
                           │                         │
              ┌────────────┼────────────┐            │
              │            │            │            │
              ▼            ▼            ▼            │
       ┌───────────┐ ┌───────────┐ ┌───────────┐    │
       │FIRST_PASS │ │ REJECTED  │ │NEED_MODIFY│────┘
       │(初审通过) │ │  (拒绝)   │ │ (需修改)  │
       └─────┬─────┘ └───────────┘ └───────────┘
             │              ▲            ▲
    ┌────────┼────────┐     │            │
    │        │        │     │            │
    ▼        ▼        ▼     │            │
┌───────┐ ┌───────┐ ┌───────┴────────────┘
│APPROVED│ │REJECTED│ │NEED_MODIFY│
│ (通过) │ │ (拒绝) │ │ (需修改) │
└───────┘ └───────┘ └──────────┘
```
